# Vars
HISTFILE=~/.zsh_history
SAVEHIST=1000 
ISWINDOWS=`uname -mrs | grep Microsoft | wc -l`
setopt inc_append_history # To save every command before it is executed 
setopt share_history # setopt inc_append_history

git config --global push.default current

# Aliases
alias vim="nvim"
mkdir -p /tmp/log

# Settings
export VISUAL=vim

source ~/.config/zsh/plugins/fixls.zsh

if [ $(command -v dircolors | wc -l) -gt 1 ]; then 
	eval "`dircolors ~/.config/zsh/dircolors.db`"
fi

#Functions
# Loop a command and show the output in vim
loop() {
    echo ":cq to quit\n" > /tmp/log/output 
    fc -ln -1 > /tmp/log/program
    while true; do
        cat /tmp/log/program >> /tmp/log/output ;
        $(cat /tmp/log/program) |& tee -a /tmp/log/output ;
        echo '\n' >> /tmp/log/output
        vim + /tmp/log/output || break;
        rm -rf /tmp/log/output
    done;
}

# Custom cd
c() {
    cd $1;
    ls;
}
alias cd="c"

# For vim mappings: 
stty -ixon

# Completions
# These are all the plugin options available: https://github.com/robbyrussell/oh-my-zsh/tree/291e96dcd034750fbe7473482508c08833b168e3/plugins
#
# Edit the array below, or relocate it to ~/.zshrc before anything is sourced
# For help create an issue at github.com/parth/.config

autoload -U compinit

plugins=(
	nvm,
	git,
	docker
)

for plugin ($plugins); do
    fpath=(~/.config/zsh/plugins/oh-my-zsh/plugins/$plugin $fpath)
done

compinit

source ~/.config/zsh/plugins/oh-my-zsh/lib/history.zsh
source ~/.config/zsh/plugins/oh-my-zsh/lib/key-bindings.zsh
source ~/.config/zsh/plugins/oh-my-zsh/lib/completion.zsh
source ~/.config/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh
source ~/.config/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
source ~/.config/zsh/keybindings.sh

# Fix for arrow-key searching
# start typing + [Up-Arrow] - fuzzy find history forward
if [[ "${terminfo[kcuu1]}" != "" ]]; then
	autoload -U up-line-or-beginning-search
	zle -N up-line-or-beginning-search
	bindkey "${terminfo[kcuu1]}" up-line-or-beginning-search
fi
# start typing + [Down-Arrow] - fuzzy find history backward
if [[ "${terminfo[kcud1]}" != "" ]]; then
	autoload -U down-line-or-beginning-search
	zle -N down-line-or-beginning-search
	bindkey "${terminfo[kcud1]}" down-line-or-beginning-search
fi

source ~/.config/zsh/prompt.sh
export PATH=$PATH:$HOME/.config/utils

# Import nvm REPLACE WITH YOUR SYSTEM PATH
source /usr/share/nvm/init-nvm.sh

# NVM Use automatically
autoload -U add-zsh-hook
load-nvmrc() {
  local node_version="$(nvm version)"
  local nvmrc_path="$(nvm_find_nvmrc)"

  if [ -n "$nvmrc_path" ]; then
    local nvmrc_node_version=$(nvm version "$(cat "${nvmrc_path}")")

    if [ "$nvmrc_node_version" = "N/A" ]; then
      nvm install
    elif [ "$nvmrc_node_version" != "$node_version" ]; then
      nvm use
    fi
  elif [ "$node_version" != "$(nvm version default)" ]; then
    echo "Reverting to nvm default version"
    nvm use default
  fi
}
add-zsh-hook chpwd load-nvmrc
load-nvmrc

# Fix autosuggest color in solarized dark theme
export ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=60'
